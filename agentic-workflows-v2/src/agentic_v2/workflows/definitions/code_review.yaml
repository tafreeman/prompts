name: code_review
description: Automated code review workflow with tiered models
version: "1.0"

# Workflow inputs
inputs:
  code_file:
    type: string
    description: Path to the code file to review
  review_depth:
    type: string
    enum: [quick, standard, deep]
    default: standard

# DAG steps
steps:
  - name: parse_code
    agent: tier0_parser
    description: Parse and analyze code structure
    inputs:
      file_path: ${inputs.code_file}
    outputs:
      ast: parsed_ast
      metrics: code_metrics

  - name: style_check
    agent: tier1_linter
    description: Check code style and formatting
    depends_on: [parse_code]
    inputs:
      ast: ${steps.parse_code.outputs.ast}
    outputs:
      issues: style_issues

  - name: complexity_analysis
    agent: tier1_analyzer
    description: Analyze code complexity
    depends_on: [parse_code]
    inputs:
      metrics: ${steps.parse_code.outputs.metrics}
    outputs:
      complexity_report: complexity

  - name: review_code
    agent: tier2_reviewer
    description: Deep code review with suggestions
    depends_on: [style_check, complexity_analysis]
    inputs:
      ast: ${steps.parse_code.outputs.ast}
      style_issues: ${steps.style_check.outputs.issues}
      complexity: ${steps.complexity_analysis.outputs.complexity_report}
    outputs:
      review: code_review

  - name: generate_summary
    agent: tier2_summarizer
    description: Generate human-readable review summary
    depends_on: [review_code]
    when: ${inputs.review_depth != 'quick'}
    inputs:
      review: ${steps.review_code.outputs.review}
    outputs:
      summary: review_summary

# Workflow outputs
outputs:
  review:
    from: ${steps.review_code.outputs.review}
  summary:
    from: ${steps.generate_summary.outputs.summary}
    optional: true
