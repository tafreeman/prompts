name: fullstack_generation
description: Generate a complete fullstack feature with parallel frontend/backend development
version: "1.0"

inputs:
  feature_spec:
    type: string
    description: Natural language description of the feature
  tech_stack:
    type: object
    description: Technology stack configuration
    default:
      frontend: react
      backend: fastapi
      database: postgresql

steps:
  # Phase 1: Architecture (no dependencies - runs first)
  - name: design_architecture
    agent: tier3_architect
    description: Design system architecture from requirements
    inputs:
      spec: ${inputs.feature_spec}
      stack: ${inputs.tech_stack}
    outputs:
      api_spec: api_design
      db_schema: database_schema
      component_tree: frontend_components

  # Phase 2: Parallel development (depends on architecture)
  - name: generate_api
    agent: tier2_coder
    description: Generate backend API endpoints
    depends_on: [design_architecture]
    inputs:
      api_spec: ${steps.design_architecture.outputs.api_spec}
      db_schema: ${steps.design_architecture.outputs.db_schema}
    outputs:
      api_code: backend_code
      api_tests: backend_tests

  - name: generate_frontend
    agent: tier2_coder
    description: Generate frontend components
    depends_on: [design_architecture]
    inputs:
      components: ${steps.design_architecture.outputs.component_tree}
      api_spec: ${steps.design_architecture.outputs.api_spec}
    outputs:
      ui_code: frontend_code
      ui_tests: frontend_tests

  - name: generate_migrations
    agent: tier1_generator
    description: Generate database migrations
    depends_on: [design_architecture]
    inputs:
      schema: ${steps.design_architecture.outputs.db_schema}
    outputs:
      migrations: db_migrations

  # Phase 3: Integration (depends on parallel phase)
  - name: generate_integration_tests
    agent: tier2_tester
    description: Generate integration tests
    depends_on: [generate_api, generate_frontend]
    inputs:
      backend: ${steps.generate_api.outputs.api_code}
      frontend: ${steps.generate_frontend.outputs.ui_code}
    outputs:
      integration_tests: e2e_tests

  # Phase 4: Review (depends on all code)
  - name: review_code
    agent: tier3_reviewer
    description: Review all generated code
    depends_on: [generate_api, generate_frontend, generate_migrations, generate_integration_tests]
    inputs:
      backend: ${steps.generate_api.outputs.api_code}
      frontend: ${steps.generate_frontend.outputs.ui_code}
      migrations: ${steps.generate_migrations.outputs.migrations}
      tests: ${steps.generate_integration_tests.outputs.integration_tests}
    outputs:
      review_report: code_review
      suggested_fixes: fixes

  # Phase 5: Final assembly (depends on review)
  - name: assemble_feature
    agent: tier1_assembler
    description: Assemble final feature package
    depends_on: [review_code]
    when: ${steps.review_code.outputs.review_report}
    inputs:
      backend: ${steps.generate_api.outputs.api_code}
      frontend: ${steps.generate_frontend.outputs.ui_code}
      migrations: ${steps.generate_migrations.outputs.migrations}
      tests: ${steps.generate_integration_tests.outputs.integration_tests}
    outputs:
      package: feature_package

outputs:
  feature_package:
    from: ${steps.assemble_feature.outputs.package}
    optional: true
  review_report:
    from: ${steps.review_code.outputs.review_report}
  all_code:
    from:
      backend: ${steps.generate_api.outputs.api_code}
      frontend: ${steps.generate_frontend.outputs.ui_code}
      migrations: ${steps.generate_migrations.outputs.migrations}
