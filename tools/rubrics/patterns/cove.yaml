# Chain-of-Verification (CoVe) Pattern Definition
# Reference: Dhuliawala et al. "Chain-of-Verification Reduces Hallucination"

id: cove
name: Chain-of-Verification
description: |
  Self-verification pattern that generates a draft answer, creates verification
  questions, independently checks them, then revises the answer based on findings.

required_phases:
  - name: Draft Answer
    required: true
    repeatable: false
    description: Initial answer before verification
  - name: Verification Questions
    required: true
    repeatable: false
    description: Questions to verify claims in draft
  - name: Independent Verification
    required: true
    repeatable: true
    description: Answer verification questions without looking at draft
  - name: Revised Answer
    required: true
    repeatable: false
    description: Final answer incorporating verification findings

ordering_constraints:
  type: strict_sequence
  sequence:
    - Draft Answer
    - Verification Questions
    - Independent Verification
    - Revised Answer
  loop: false
  rules:
    - Draft must come first
    - Verification Questions must reference Draft claims
    - Independent Verification must not peek at Draft
    - Revised Answer must incorporate verification results

phase_markers:
  Draft Answer:
    - "^\\*{0,2}Draft\\s*[Aa]nswer\\*{0,2}:"
    - "^\\*{0,2}Initial [Aa]nswer\\*{0,2}:"
    - "^\\*{0,2}First [Aa]ttempt\\*{0,2}:"
    - "^\\*{0,2}Baseline [Rr]esponse\\*{0,2}:"
    - "Draft Answer:"
    - "Baseline Response:"
  Verification Questions:
    - "^\\*{0,2}Verification [Qq]uestions?\\*{0,2}:"
    - "^\\*{0,2}Questions to [Vv]erify\\*{0,2}:"
    - "^\\*{0,2}Fact-check [Qq]uestions\\*{0,2}:"
    - "Verification Questions:"
  Independent Verification:
    - "^\\*{0,2}Independent [Vv]erification\\*{0,2}:"
    - "^\\*{0,2}Verification [Rr]esults?\\*{0,2}:"
    - "^\\*{0,2}Fact-check [Rr]esults?\\*{0,2}:"
    - "Independent Verification:"
  Revised Answer:
    - "^\\*{0,2}Revised [Aa]nswer\\*{0,2}:"
    - "^\\*{0,2}Final [Aa]nswer\\*{0,2}:"
    - "^\\*{0,2}Corrected [Aa]nswer\\*{0,2}:"
    - "Revised Answer:"

constraints:
  forbid:
    - Skipping verification phase
    - Verification that just rephrases draft
    - Revised answer identical to draft when errors found
    - Leading questions that assume draft is correct
  require:
    - At least 2 verification questions
    - Independent verification for each question
    - Explicit revision reasoning

pattern_specific_dimensions:
  verification_question_quality:
    description: Are questions independent and non-leading?
    scale: [0, 5]
  evidence_independence:
    description: Is verification truly independent of draft?
    scale: [0, 5]
  revision_delta:
    description: Does final answer change when verification fails?
    scale: [0, 5]

minimum_questions: 2
max_questions: 5
