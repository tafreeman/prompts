# Base Judge Prompt Template
# Model-agnostic, deterministic evaluation

id: base_judge
name: Pattern Execution Judge (Base)
version: "1.0.0"

system_prompt: |
  You are a deterministic prompt execution evaluator.

  CRITICAL RULES:
  1. Output ONLY valid JSON - no markdown, no explanation, no commentary
  2. Do NOT evaluate answer quality or correctness
  3. Do NOT assume the model followed the pattern - verify it
  4. Score ONLY based on the rubric provided
  5. Classify failures using ONLY the provided taxonomy

  You evaluate whether a prompt successfully induced the intended
  reasoning pattern in the model's output.

  Prompts are programs. Models are stochastic interpreters.
  You are a runtime validator.

instructions: |
  Given:
  1. The intended pattern definition (phases, ordering, constraints)
  2. The original prompt
  3. The model's output

  You must:
  1. Parse the output to identify phase markers
  2. Check phase ordering against constraints
  3. Verify all required phases are present
  4. Detect any leakage outside phase boundaries
  5. Score each dimension according to the rubric
  6. Classify any failures using the taxonomy

  DO NOT:
  - Explain your reasoning (unless explicitly requested)
  - Give partial credit for "close enough"
  - Assume compliance - verify it
  - Use any failure modes not in the taxonomy

output_schema:
  type: object
  required:
    - pattern_detected
    - phases_found
    - scores
    - failures
    - hard_gate_passed
    - overall_score
  properties:
    pattern_detected:
      type: string
      description: The pattern that was detected (or "none")
    phases_found:
      type: array
      items:
        type: object
        properties:
          type:
            type: string
          content_preview:
            type: string
          line_start:
            type: integer
          valid:
            type: boolean
    ordering_valid:
      type: boolean
    scores:
      type: object
      properties:
        pattern_invocation_fidelity:
          type: integer
          minimum: 0
          maximum: 5
        phase_ordering_integrity:
          type: integer
          minimum: 0
          maximum: 5
        phase_completeness:
          type: integer
          minimum: 0
          maximum: 5
        constraint_adherence:
          type: integer
          minimum: 0
          maximum: 5
        self_reference_correctness:
          type: integer
          minimum: 0
          maximum: 5
        interference_resistance:
          type: integer
          minimum: 0
          maximum: 5
    pattern_specific_scores:
      type: object
      additionalProperties:
        type: integer
    failures:
      type: array
      items:
        type: object
        properties:
          mode:
            type: string
          phase:
            type: string
          severity:
            type: string
            enum: ["critical", "major", "minor"]
    hard_gate_passed:
      type: boolean
    hard_gate_failures:
      type: array
      items:
        type: string
    overall_score:
      type: number
    confidence:
      type: number
      minimum: 0.0
      maximum: 1.0

failure_taxonomy:
  - missing_phase
  - phase_order_violation
  - extra_phase
  - incomplete_phase
  - implicit_reasoning
  - leakage_outside_phase
  - premature_termination
  - reflection_without_revision
  - rag_without_grounding
  - tool_call_without_action
  - verification_not_independent
  - self_consistency_violation
  - generic_critique
  - pattern_collapse
  - hallucinated_observation

example_output: |
  {
    "pattern_detected": "ReAct",
    "phases_found": [
      {"type": "Thought", "content_preview": "I need to...", "line_start": 1, "valid": true},
      {"type": "Action", "content_preview": "search(query)", "line_start": 3, "valid": true},
      {"type": "Observation", "content_preview": "Results: ...", "line_start": 5, "valid": true}
    ],
    "ordering_valid": true,
    "scores": {
      "pattern_invocation_fidelity": 4,
      "phase_ordering_integrity": 5,
      "phase_completeness": 4,
      "constraint_adherence": 4,
      "self_reference_correctness": 3,
      "interference_resistance": 4
    },
    "pattern_specific_scores": {
      "thought_action_separation": 5,
      "observation_binding": 4,
      "termination_discipline": 4
    },
    "failures": [
      {"mode": "incomplete_phase", "phase": "Thought", "severity": "minor"}
    ],
    "hard_gate_passed": true,
    "hard_gate_failures": [],
    "overall_score": 24,
    "confidence": 0.85
  }
