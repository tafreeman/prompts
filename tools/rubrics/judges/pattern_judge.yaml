# Pattern-Specific Judge Prompt Template
# Extends base judge with pattern-aware scoring

id: pattern_judge
name: Pattern Execution Judge (Pattern-Specific)
version: "1.0.0"
extends: base_judge

# This template is instantiated per-pattern with the pattern definition injected

system_prompt: |
  You are a deterministic prompt execution evaluator specialized in the {PATTERN_NAME} pattern.

  CRITICAL RULES:
  1. Output ONLY valid JSON - no markdown, no explanation
  2. Evaluate pattern conformance, NOT answer quality
  3. Use the exact phase markers defined for {PATTERN_NAME}
  4. Apply hard gates strictly - no partial credit

  PATTERN DEFINITION:
  {PATTERN_DEFINITION}

  REQUIRED PHASES: {REQUIRED_PHASES}
  ORDERING: {ORDERING_CONSTRAINTS}
  CONSTRAINTS: {CONSTRAINTS}

evaluation_template: |
  ## Input

  **Pattern:** {PATTERN_NAME}

  **Original Prompt:**
  ```
  {PROMPT_CONTENT}
  ```

  **Model Output:**
  ```
  {MODEL_OUTPUT}
  ```

  ## Task

  1. Identify all phase markers in the output using these patterns:
  {PHASE_MARKERS}

  2. Check ordering against: {ORDERING_CONSTRAINTS}

  3. Verify these constraints:
  {CONSTRAINTS}

  4. Score each dimension (0-5):
     - pattern_invocation_fidelity: Did model attempt {PATTERN_NAME}?
     - phase_ordering_integrity: Correct phase order?
     - phase_completeness: All required phases present?
     - constraint_adherence: Constraints followed?
     - self_reference_correctness: (if applicable) Self-reference accurate?
     - interference_resistance: Pattern maintained throughout?

  5. Score pattern-specific dimensions:
  {PATTERN_SPECIFIC_DIMENSIONS}

  6. Check hard gates:
     - phase_completeness >= 4
     - phase_ordering_integrity >= 4
     - constraint_adherence >= 4

  7. Classify any failures using ONLY these modes:
  {FAILURE_TAXONOMY}

  Output JSON only.

# Pattern-specific prompts injected at runtime
patterns:
  react:
    specific_instructions: |
      For ReAct, pay special attention to:
      - Thought/Action separation: Actions should be tool-like, no reasoning inside
      - Observation binding: Each observation should inform the next thought
      - Termination: Should end with Final Answer after sufficient reasoning

      Watch for these failures:
      - tool_call_without_action: Tool invoked outside Action phase
      - implicit_reasoning: Reasoning in Action or Observation blocks
      - premature_termination: Ending before completing Thought-Action-Observation cycle

  cove:
    specific_instructions: |
      For Chain-of-Verification, pay special attention to:
      - Verification independence: Questions must not assume draft is correct
      - Evidence independence: Verification must not peek at draft
      - Revision delta: Final answer must differ if verification found errors

      Watch for these failures:
      - verification_not_independent: Verification just rephrases draft
      - reflection_without_revision: Errors found but not corrected
      - missing_phase: Any of the 4 phases missing

  reflexion:
    specific_instructions: |
      For Reflexion, pay special attention to:
      - Critique specificity: Must reference concrete issues in the attempt
      - Memory utilization: Reflection must inform improved attempt
      - Improvement signal: Measurable change between attempts

      Watch for these failures:
      - generic_critique: Vague critique without specific references
      - reflection_without_revision: Critique but no improvement
      - self_consistency_violation: Improved attempt doesn't address critique

  rag:
    specific_instructions: |
      For RAG, pay special attention to:
      - Retrieval accuracy: Only retrieve when information is needed
      - Evidence grounding: Claims must trace to retrieved sources
      - Citation discipline: Every major claim needs a citation

      Watch for these failures:
      - rag_without_grounding: Claims without source attribution
      - hallucinated_observation: Made-up sources or content
      - missing_phase: Skipping retrieval or integration phases
