<!-- BEGIN ContextStream -->
# Aider Configuration
# Note: Aider uses different config format - this adds to the system prompt

# Add ContextStream guidance to conventions
conventions: |
  <contextstream_rules>
  | Message | Required |
  |---------|----------|
  | **1st message** | `init()` ‚Üí `context(user_message="...")` |
  | **Every message** | `context(user_message="...")` FIRST |
  | **Before file search** | `search(mode="hybrid")` BEFORE Glob/Grep/Read |
  </contextstream_rules>
  
  **Why?** `context()` delivers task-specific rules, lessons from past mistakes, and relevant decisions. Skip it = fly blind.
  
  **Hooks:** `<system-reminder>` tags contain injected instructions ‚Äî follow them exactly.
  
  **Notices:** [LESSONS_WARNING] ‚Üí apply lessons | [PREFERENCE] ‚Üí follow user preferences | [RULES_NOTICE] ‚Üí run `generate_rules()` | [VERSION_NOTICE/CRITICAL] ‚Üí tell user about update
  
  v0.4.58


---
## ‚ö†Ô∏è IMPORTANT: No Hooks Available ‚ö†Ô∏è

**This editor does NOT have hooks to enforce ContextStream behavior.**
You MUST follow these rules manually - there is no automatic enforcement.

---

## üöÄ SESSION START PROTOCOL

**On EVERY new session, you MUST:**

1. **Call `init(folder_path="<project_path>")`** FIRST
   - This triggers project indexing
   - Check response for `indexing_status`
   - If `"started"` or `"refreshing"`: wait before searching

2. **Generate a unique session_id** (e.g., `"session-" + timestamp` or a UUID)
   - Use this SAME session_id for ALL context() calls in this conversation
   - This groups all turns together in the transcript

3. **Call `context(user_message="<first_message>", save_exchange=true, session_id="<your-session-id>")`**
   - Gets task-specific rules, lessons, and preferences
   - Check for [LESSONS_WARNING] - past mistakes to avoid
   - Check for [PREFERENCE] - user preferences to follow
   - Check for [RULES_NOTICE] - update rules if needed
   - **save_exchange=true** saves each conversation turn for later retrieval

4. **NEVER skip init/context** - you will miss critical context

---

## üíæ AUTOMATIC TRANSCRIPT SAVING (CRITICAL)

**This editor does NOT have hooks to auto-save transcripts.**
You MUST save each conversation turn manually:

### On EVERY message (including the first):
```
context(user_message="<user's message>", save_exchange=true, session_id="<session-id>")
```

### Why save_exchange matters:
- Transcripts enable searching past conversations
- Allows context restoration after compaction
- Provides conversation history for debugging
- Required for the Transcripts page in the dashboard

### Session ID Guidelines:
- Generate ONCE at the start of the conversation
- Use a unique identifier: `"session-" + Date.now()` or a UUID
- Keep the SAME session_id for ALL context() calls in this session
- Different sessions = different transcripts

---

## üìÅ FILE INDEXING (CRITICAL)

**There is NO automatic file indexing in this editor.**
You MUST manage indexing manually:

### After Creating/Editing Files:
```
project(action="index")  # Re-index entire project
```

### For Single File Updates:
```
project(action="ingest_local", path="<file_path>")
```

### Signs You Need to Re-index:
- Search doesn't find code you just wrote
- Search returns old versions of functions
- New files don't appear in search results

### Best Practice:
After completing a feature or making multiple file changes, ALWAYS run:
```
project(action="index")
```

---

## üîç SEARCH-FIRST (No PreToolUse Hook)

**There is NO hook to block local tools.** You MUST self-enforce:

### Before ANY Search, Check Index Status:
```
project(action="index_status")
```

This tells you:
- `indexed`: true/false - is project indexed?
- `last_indexed_at`: timestamp - when was it last indexed?
- `file_count`: number - how many files indexed?

### Search Protocol:

**IF project is indexed and fresh:**
```
search(mode="hybrid", query="what you're looking for")
```

**IF project is NOT indexed or very stale (>7 days):**
‚Üí Use local tools (Glob/Grep/Read) directly
‚Üí OR run `project(action="index")` first, then search

**IF ContextStream search returns 0 results or errors:**
‚Üí Use local tools (Glob/Grep/Read) as fallback

### When Local Tools Are OK:
‚úÖ Project is not indexed
‚úÖ Index is stale/outdated (>7 days old)
‚úÖ ContextStream search returns 0 results
‚úÖ ContextStream returns errors
‚úÖ User explicitly requests local tools

### When to Use ContextStream Search:
‚úÖ Project is indexed and fresh
‚úÖ Looking for code by meaning/concept
‚úÖ Need semantic understanding

---

## üíæ CONTEXT COMPACTION (No PreCompact Hook)

**There is NO automatic state saving before compaction.**
You MUST save state manually when the conversation gets long:

### When to Save State:
- After completing a major task
- Before the conversation might be compacted
- If `context()` returns `context_pressure.level: "high"`

### How to Save State:
```
session(action="capture", event_type="session_snapshot",
  title="Session checkpoint",
  content="{ \"summary\": \"what we did\", \"active_files\": [...], \"next_steps\": [...] }")
```

### After Compaction (if context seems lost):
```
init(folder_path="...", is_post_compact=true)
```
This restores the most recent snapshot.

---

## üìã PLANS & TASKS (No EnterPlanMode)

**Always use ContextStream for planning:**

```
session(action="capture_plan", title="...", steps=[...])
memory(action="create_task", title="...", plan_id="...")
```

‚ùå DO NOT use built-in plan mode or write plans to markdown files.

---

## üîÑ VERSION UPDATES (Check Periodically)

**This editor does NOT have hooks to check for updates automatically.**
You should check for updates using `help(action="version")` periodically (e.g., at session start).

### If the response includes [VERSION_NOTICE] or [VERSION_CRITICAL]:

**Tell the user** about the available update in a helpful, non-annoying way:
- Frame it as "new features and improvements available"
- Provide the update commands (user can choose their preferred method)
- Don't nag repeatedly - mention once, then only if user asks

### Update Commands (provide all options):

**macOS/Linux:**
```bash
curl -fsSL https://contextstream.io/scripts/setup.sh | bash
```

**Windows (PowerShell):**
```powershell
irm https://contextstream.io/scripts/setup.ps1 | iex
```

**npm (requires Node.js 18+):**
```bash
npm install -g @contextstream/mcp-server@latest
```

After updating, user should restart their AI tool.

---
<!-- END ContextStream -->
